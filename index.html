<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fino</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#60a5fa;--muted:#9ca3af;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; margin:0; background:linear-gradient(180deg,#071029 0%,#06101b 100%); color:#e6eef8; padding:18px}
    .wrap{max-width:950px;margin:18px auto}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between}
    h1{font-size:20px;margin:0}
    .logo{height:40px}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6);}
    .row{display:flex;gap:12px;align-items:center}
    input,select,button,textarea{background:var(--glass);border:1px solid rgba(255,255,255,0.04);color:inherit;padding:8px;border-radius:8px}
    .grid{display:grid;gap:12px}
    .cols-3{grid-template-columns:1fr 1fr 1fr}
    .cols-2{grid-template-columns:1fr 1fr}
    .muted{color:var(--muted);font-size:13px}
    .right{text-align:right}

    @media (max-width:720px){.cols-3,.cols-2{grid-template-columns:1fr}}

    .expense-list{max-height:260px;overflow:auto;margin-top:10px}
    .expense-item{display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid rgba(255,255,255,0.02)}
    .btn{cursor:pointer}
    .btn-primary{background:linear-gradient(90deg,var(--accent),#7dd3fc);color:#042a3a;border:none}
    .small{font-size:13px;padding:6px}
    .danger{background:transparent;border:1px solid rgba(255,60,60,0.15);color:#ff9b9b}
    .pill{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:999px;font-size:13px}
    .progress{height:12px;background:rgba(255,255,255,0.04);border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,#34d399,#60a5fa)}
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="row">
        <img src="assets/logo.webp" alt="Logo" class="logo" />
        <!-- <h1></h1> -->
      </div>
      <div class="row">
        <div id="user-info" class="muted">Not signed in</div>
        <button id="auth-btn" class="btn small">Sign in</button>
      </div>
    </header>

    <section style="margin-top:12px" class="card">
      <div class="grid cols-3">
        <div>
          <div class="muted">Emergency Fund</div>
          <div style="font-weight:700;font-size:18px">₹ <span id="emergency">32000</span></div>
          <div style="margin-top:6px;display:flex;gap:6px">
            <input id="addEmergency" type="number" placeholder="Add amount" style="width:100px" />
            <button id="addEmergencyBtn" class="btn small">Add</button>
          </div>
        </div>
        <div>
          <div class="muted">Add Income (anytime)</div>
          <input id="income" type="number" placeholder="Enter income received" />
          <button id="add-income" class="btn small btn-primary" style="margin-top:6px">Add Income</button>
        </div>
        <div>
          <div class="muted">Savings rule</div>
          <div style="display:flex;gap:8px;align-items:center">
            <input id="savingsPercent" type="number" placeholder="%" style="width:84px" />
            <div class="muted">or</div>
            <input id="savingsFixed" type="number" placeholder="Fixed amount" style="width:140px" />
          </div>
          <div class="muted" style="margin-top:6px">You can set % OR fixed amount. % takes precedence if provided.</div>
        </div>
      </div>

      <div style="margin-top:12px" class="grid cols-2">
        <div class="card" style="background:transparent;padding:10px">
          <div class="muted">Total savings allocated</div>
          <div style="font-weight:700;font-size:18px">₹ <span id="allocatedSavings">0</span></div>
        </div>
        <div class="card" style="background:transparent;padding:10px">
          <div class="muted">Available balance (carry over included)</div>
          <div style="font-weight:700;font-size:18px">₹ <span id="spendable">0</span></div>
        </div>
      </div>

    </section>

    <section style="margin-top:12px" class="card">
      <h3 style="margin:0 0 8px 0">Add Expense</h3>
      <div class="grid cols-3">
        <input id="amount" type="number" placeholder="Amount (₹)" />
        <input id="category" placeholder="Category (e.g., Food)" />
        <input id="note" placeholder="Note (optional)" />
      </div>
      <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
        <input id="date" type="date" />
        <button id="add-expense" class="btn btn-primary small">Add Expense</button>
        <button id="clear-expenses" class="btn small danger">Clear local data</button>
      </div>

      <div style="margin-top:12px">
        <div class="muted">This month</div>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:700;font-size:18px">Spent: ₹ <span id="spent">0</span></div>
          <div class="muted">Remaining: <span id="remaining">₹ 0</span></div>
        </div>
        <div class="expense-list card" id="list"></div>
      </div>

    </section>

    <section style="margin-top:12px" class="card">
      <h3 style="margin:0 0 8px 0">Goals (save toward future purchases)</h3>
      <div class="grid cols-3">
        <input id="goal-title" placeholder="Goal (e.g., Laptop)" />
        <input id="goal-target" type="number" placeholder="Target amount (₹)" />
        <input id="goal-deadline" type="date" />
      </div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="add-goal" class="btn small btn-primary">Add Goal</button>
      </div>
      <div id="goals" style="margin-top:10px"></div>
    </section>

    <footer>Starter app — paste your Firebase config into the script section to enable syncing. Works locally (LocalStorage) if no config provided.</footer>
  </div>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js"></script>

<script>
const FIREBASE_CONFIG = {
  apiKey: "AIzaSyB78wE5UT85Ww155sKOALPJni1_QxROVes",
  authDomain: "fino-denverdude.firebaseapp.com",
  projectId: "fino-denverdude",
  storageBucket: "fino-denverdude.firebasestorage.app",
  messagingSenderId: "921245921700",
  appId: "1:921245921700:web:20574173a041a3a4ed9131",
  measurementId: "G-12BJY9CT9G"
};

// Init Firebase
firebase.initializeApp(FIREBASE_CONFIG);
const auth = firebase.auth();
const db = firebase.firestore();

const $ = id => document.getElementById(id);
function fmt(n){ return Number(n||0).toLocaleString(); }

let state = { balance:0, savingsPercent:0, savingsFixed:0, expenses:[], goals:[], emergency:32000 };
let userDocRef = null;

// --- AUTH ---
const authBtn = $("auth-btn");
const userInfo = $("user-info");

auth.onAuthStateChanged(u=>{
  if(u){
    userInfo.textContent = u.displayName || u.email;
    authBtn.textContent = "Sign out";
    userDocRef = db.collection("users").doc(u.uid);
    loadState();
  }else{
    userInfo.textContent = "Not signed in";
    authBtn.textContent = "Sign in";
    userDocRef = null;
    state = { balance:0, savingsPercent:0, savingsFixed:0, expenses:[], goals:[], emergency:32000 };
    render();
  }
});

authBtn.addEventListener("click", ()=>{
  if(auth.currentUser) auth.signOut();
  else auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
});

// --- FIRESTORE SYNC ---
async function loadState(){
  if(!userDocRef) return;
  const snap = await userDocRef.get();
  if(snap.exists){
    state = snap.data();
  } else {
    await userDocRef.set(state);
  }
  render();
}

function persist(){
  if(userDocRef) userDocRef.set(state);
  render();
}

// --- BUSINESS LOGIC (same as before) ---
function computeSavings(income, pct, fixed){ income=Number(income)||0; pct=Number(pct)||0; fixed=Number(fixed)||0; if(pct>0) return Math.round(income*(pct/100)); return Math.round(Math.min(fixed||0,income)); }
function monthKey(dateStr){ const d=dateStr?new Date(dateStr):new Date(); return `${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2,'0')}`; }
function getThisMonthExpenses(){ const key=monthKey(); return (state.expenses||[]).filter(e=>monthKey(e.date)===key); }
function totalSpentThisMonth(){ return getThisMonthExpenses().reduce((s,e)=>s+Number(e.amount||0),0); }

function render(){
  $('emergency').textContent = fmt(state.emergency);
  $('savingsPercent').value = state.savingsPercent||'';
  $('savingsFixed').value = state.savingsFixed||'';

  const allocated = computeSavings(state.balance, state.savingsPercent, state.savingsFixed);
  $('allocatedSavings').textContent = fmt(allocated);

  const spent = totalSpentThisMonth();
  $('spendable').textContent = fmt(Math.max(0, state.balance - allocated));
  $('spent').textContent = fmt(spent);
  $('remaining').textContent = `₹ ${fmt(Math.max(0, (state.balance - allocated) - spent))}`;

  const list = $('list'); list.innerHTML='';
  const items = getThisMonthExpenses().slice().reverse();
  if(items.length===0) list.innerHTML = '<div class="muted">No expenses for this month</div>';
  for(const e of items){
    const div=document.createElement('div'); div.className='expense-item';
    div.innerHTML = `<div><div style="font-weight:600">₹ ${fmt(e.amount)}</div><div class="muted">${e.category} • ${e.note||''}</div></div><div class="muted">${e.date}</div>`;
    list.appendChild(div);
  }

  const gdiv=$('goals'); gdiv.innerHTML='';
  for(const [i,g] of (state.goals||[]).entries()){
    const wrapper=document.createElement('div'); wrapper.className='card'; wrapper.style.marginBottom='8px';
    const saved=g.saved||0; const pct=Math.min(100,Math.round((saved/g.target)*100));
    wrapper.innerHTML=`
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style='font-weight:700'>${g.title}</div>
        <div class='muted'>Target ₹ ${fmt(g.target)}</div>
      </div>
      <div class='muted small'>Saved: ₹ ${fmt(saved)}</div>
      <div class='progress' style='margin-top:6px'><i style='width:${pct}%'></i></div>
      <div style='margin-top:8px;display:flex;gap:6px;align-items:center'>
        <input id='goal-add-${i}' type='number' placeholder='Amount' style='width:100px' />
        <button class='btn small' onclick='addToGoal(${i})'>Add</button>
        <button class='btn small' onclick='withdrawFromGoal(${i})'>Withdraw</button>
        <button class='btn small danger' onclick='deleteGoal(${i})'>Delete</button>
      </div>`;
    gdiv.appendChild(wrapper);
  }
}

// --- EVENTS ---
$('add-income').addEventListener('click', ()=>{ const inc=Number($('income').value||0); if(!inc){alert('Enter income');return;} state.balance+=inc; $('income').value=''; persist(); });
$('savingsPercent').addEventListener('change', e=>{ state.savingsPercent=Number(e.target.value||0); persist(); });
$('savingsFixed').addEventListener('change', e=>{ state.savingsFixed=Number(e.target.value||0); persist(); });
$('add-expense').addEventListener('click', ()=>{ const amount=Number($('amount').value||0); if(!amount){alert('Enter amount');return;} const cat=$('category').value||'Misc'; const note=$('note').value||''; const date=$('date').value||(new Date()).toISOString().slice(0,10); state.expenses.push({amount,category:cat,note,date}); state.balance-=amount; persist(); $('amount').value='';$('category').value='';$('note').value=''; });
$('add-goal').addEventListener('click', ()=>{ const title=$('goal-title').value||''; const target=Number($('goal-target').value||0); const deadline=$('goal-deadline').value||null; if(!title||!target){alert('Enter goal title and target');return;} state.goals.push({title,target,deadline,saved:0}); $('goal-title').value='';$('goal-target').value='';$('goal-deadline').value=''; persist(); });
$('addEmergencyBtn').addEventListener('click', ()=>{ const amt=Number($('addEmergency').value||0); if(!amt){alert('Enter amount');return;} state.emergency+=amt; $('addEmergency').value=''; persist(); });

window.addToGoal = function(i){ const amt=Number(document.getElementById(`goal-add-${i}`).value||0); if(!amt){alert('Enter amount');return;} if(amt>state.balance){alert('Not enough balance');return;} state.goals[i].saved+=amt; state.balance-=amt; persist(); }
window.withdrawFromGoal = function(i){ const amt=Number(document.getElementById(`goal-add-${i}`).value||0); if(!amt){alert('Enter amount');return;} if(amt>state.goals[i].saved){alert('Not enough saved');return;} state.goals[i].saved-=amt; state.balance+=amt; persist(); }
window.deleteGoal = function(i){ if(confirm('Delete this goal? Saved money will return to balance.')){ state.balance+=state.goals[i].saved; state.goals.splice(i,1); persist(); } }
</script>

</body>
</html>